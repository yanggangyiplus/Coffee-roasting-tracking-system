# Coffee Roasting Tracking System

온도·습도·가열 패턴 기반 로스팅 단계 추적 및 예측 시스템

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/)
[![Streamlit](https://img.shields.io/badge/Streamlit-1.28+-red.svg)](https://streamlit.io/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

## 프로젝트 미리보기

*Streamlit 대시보드 화면 - 실시간 로스팅 추적 및 단계 감지*

## 핵심 성과 요약

| 항목 | 성과 |
|:---:|:---:|
| **로스팅 단계 감지** | 건조/갈변/1차 크랙/발열/2차 크랙 자동 감지 |
| **RoR 계산** | Rate of Rise 실시간 계산 및 시각화 |
| **배전도 예측** | 목표 배전도 도달 시간 예측 알고리즘 |
| **대시보드** | Streamlit 기반 실시간 모니터링 UI |
| **프로파일 관리** | SQLite 기반 프로파일 저장 및 비교 분석 |
| **구현 범위** | 센서 데이터 처리부터 예측까지 End-to-End 구현 |

## 문제 정의 & 해결 목적

로스팅은 경험 의존도가 매우 높은 공정입니다. 실시간 온도/습도 변화 기록이 어렵고, 초보자는 적정 배전점(약·중·강배전)을 잡기 힘들며, 1차/2차 크랙 타이밍이 매번 달라집니다. 또한 외부 온도·습도 등 환경 변화에 따라 로스팅 시간이 계속 흔들립니다.

이 프로젝트는 환경 데이터 기반으로 로스팅 단계를 **정량적으로** 추적·예측하여 경험 의존도를 줄이고, 재현 가능한 로스팅 프로파일을 만드는 것이 목표입니다.

## 프로젝트 개요

### 목적
로스터기 센서 데이터(온도·습도·가열량·시간)를 분석해 로스팅 단계를 실시간으로 추적하고, 목표 배전도 도달 시점을 예측·알림해주는 데이터 기반 로스팅 어시스턴트를 구축합니다.

### 주요 특징
- **다양한 데이터 입력 모드**: 수동 입력, 파일 업로드(CSV/엑셀), 실시간 센서 스트림 지원
- **실시간 센서 데이터 처리**: 원두 온도, 드럼 온도, 습도, 가열량 데이터 수집 및 처리
- **환경 데이터 추적**: 주변 온도/습도(날씨 데이터) 추적 및 시각화
- **RoR 자동 계산**: Rate of Rise (온도 상승률) 실시간 계산
- **로스팅 단계 자동 감지**: 생원두, 건조, 갈변, 1차 크랙, 발열, 2차 크랙 단계 자동 감지 알고리즘
- **배전도 감지**: 생원두, 약배전, 중배전, 중강배전, 강배전 상태 자동 감지
- **원두 색상 감지**: 온도 기반 원두 색상 자동 감지 및 표시
- **목표 배전도 예측**: 약배전/중배전/중강배전/강배전 도달 시간 예측
- **실시간 대시보드**: Streamlit 기반 모니터링 및 시각화
- **프로파일 저장/관리**: SQLite 기반 프로파일 저장 및 비교 분석 기능
- **데이터 다운로드**: 실시간 데이터를 CSV 형식으로 다운로드 가능

## 시스템 아키텍처

### 전체 시스템 구조

```
┌──────────────────┐     ┌──────────────────────┐     ┌─────────────────────┐
│  센서 데이터       │ --> │  데이터 수집 모듈      │ --> │  실시간 처리 엔진     │
│  (온도/습도/가열량) │     │  (SensorDataProcessor)│     │  (RoR 계산)          │
└──────────────────┘     └──────────────────────┘     └─────────────────────┘
                                                                    │
                                                                    ▼
                                              ┌──────────────────────────────┐
                                              │  로스팅 단계 추적 알고리즘     │
                                              │  (RoastingStageDetector)     │
                                              └──────────────────────────────┘
                                                                    │
                                                                    ▼
                                              ┌──────────────────────────────┐
                                              │  목표 배전도 도달 예측 모듈    │
                                              │  (RoastLevelPredictor)       │
                                              └──────────────────────────────┘
                                                                    │
                                                                    ▼
                                              ┌──────────────────────────────┐
                                              │  Streamlit 대시보드          │
                                              │  (실시간 시각화 및 모니터링)   │
                                              └──────────────────────────────┘
                                                                    │
                                                                    ▼
                                              ┌──────────────────────────────┐
                                              │  프로파일 저장/관리          │
                                              │  (SQLite Database)           │
                                              └──────────────────────────────┘
```

### 데이터 파이프라인

```
센서 데이터 (BT/ET/RH/Heating Power)
    │
    ▼
┌──────────────────────────┐
│   데이터 수집 모듈        │
│  - 타임스탬프 추가        │
│  - 데이터 검증            │
└───────────┬──────────────┘
            │
            ▼
┌─────────────────────────┐
│   RoR 계산              │
│  - 온도 변화율 계산      │
│  - 시간 윈도우 기반      │
└───────────┬─────────────┘
            │
            ▼
┌─────────────────────────┐
│   단계 감지 알고리즘     │
│  - 온도 임계값 체크      │
│  - RoR 패턴 분석        │
│  - 크랙 감지            │
└───────────┬─────────────┘
            │
            ▼
┌─────────────────────────┐
│   배전도 도달 예측      │
│  - 선형 예측 모델       │
│  - RoR 감쇠 보정       │
│  - 진행률 계산          │
└───────────┬─────────────┘
            │
            ▼
┌─────────────────────────┐
│   대시보드 시각화       │
│  - 실시간 그래프        │
│  - 상태 표시            │
│  - 알림 표시            │
└─────────────────────────┘
```

## 모델/기술 스택

| 영역 | 기술 | 선택 이유 |
|------|------|----------|
| **언어** | Python 3.8+ | 데이터 처리 및 분석에 표준 언어 |
| **데이터 처리** | Pandas, NumPy | 센서 데이터 처리 및 통계 분석 |
| **시각화** | Matplotlib, Plotly | 인터랙티브 차트 및 실시간 시각화 |
| **대시보드** | Streamlit | 빠른 프로토타이핑 및 실시간 모니터링 UI 구축 |
| **모델링** | scikit-learn | 회귀 모델 기반 예측 (선택적) |
| **데이터베이스** | SQLite | 경량 프로파일 저장 및 관리 |

## 핵심 알고리즘 설명

### RoR (Rate of Rise) 계산

RoR은 온도 상승률을 나타내는 지표로, 로스팅 진행 상황을 파악하는 핵심 변수입니다.

```python
RoR = (T_now - T_prev) / (time_now - time_prev)  # 단위: 도/분
```

- **높은 RoR**: 급격한 온도 상승 (초반 건조 단계, 크랙 직전)
- **낮은 RoR**: 완만한 온도 상승 (갈변 단계, 발열 구간)
- **RoR 급감**: 크랙 발생 신호 (1차/2차 크랙 감지에 활용)

### 로스팅 단계 감지 알고리즘

#### 1. 건조 단계 (Drying Phase)
- **온도 범위**: 50°C ~ 150°C
- **특징**: 높은 습도, 급격한 온도 상승

#### 2. 갈변 단계 (Maillard Phase)
- **온도 범위**: 150°C ~ 190°C
- **특징**: 완만한 온도 상승, RoR 감소

#### 3. 1차 크랙 (First Crack)
- **온도 범위**: 190°C ~ 205°C
- **감지 조건**:
  - 온도가 범위 내 도달
  - RoR이 급격히 감소 (5도/분 이상)
  - 온도 변화 패턴 급변

#### 4. 발열/발화 구간 (Development)
- **온도 범위**: 205°C ~ 220°C
- **특징**: 1차 크랙 이후 ~ 2차 크랙 이전

#### 5. 2차 크랙 (Second Crack)
- **온도 범위**: 220°C ~ 240°C
- **감지 조건**:
  - 1차 크랙 이후
  - 온도가 범위 내 도달
  - RoR이 급격히 감소 (3도/분 이상)

### 목표 배전도 도달 예측

현재 상태를 기반으로 목표 배전도에 도달하는 시간을 예측합니다.

**예측 모델**:
```python
남은_온도차 = TargetTemp - CurrentTemp
예상시간 = 남은_온도차 / 현재 RoR
```

**보정 요소**:
- RoR 감소 추세 고려 (지수 감쇠 모델)
- 최근 온도 변화 패턴 분석
- 진행률 계산 및 표시

**배전도별 목표 온도**:
- 약배전: 195~205°C (1차 크랙 직후)
- 중배전: 205~215°C
- 중강배전: 215~225°C
- 강배전: 225~240°C (2차 크랙 이후)

## 실행 방법

### Quick Start

```bash
# 저장소 클론
git clone <repository-url>
cd Coffee-roasting-tracking-system

# 가상환경 생성 및 활성화
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 의존성 설치
pip install -r requirements.txt

# 샘플 CSV 파일 생성 (선택사항)
python scripts/create_sample_csv.py

# 대시보드 실행
streamlit run app/main.py
# 또는
bash scripts/run_dashboard.sh
```

브라우저에서 `http://localhost:8501` 접속

### 데이터 입력 모드

시스템은 세 가지 데이터 입력 모드를 지원합니다:

1. **수동 입력 모드**: 웹 인터페이스를 통해 센서 데이터를 직접 입력
2. **파일 업로드 모드**: CSV 또는 엑셀 파일을 업로드하여 데이터 로드
3. **실시간 센서 모드**: 실제 센서 하드웨어와 연동하여 실시간 데이터 수집

### 파일 형식

CSV/엑셀 파일은 다음 컬럼을 포함해야 합니다 (컬럼 이름은 유연하게 매핑됩니다):

**필수 컬럼**:
- `bean_temp` 또는 `원두온도`: 원두 온도 (섭씨)
- `drum_temp` 또는 `드럼온도`: 드럼 온도 (섭씨)
- `humidity` 또는 `습도`: 습도 (%)
- `heating_power` 또는 `가열량`: 가열량 (%)

**선택 컬럼**:
- `timestamp` 또는 `time`: 타임스탬프 또는 경과 시간
- `ambient_temp` 또는 `주변온도`: 주변 온도 (섭씨)
- `ambient_humidity` 또는 `주변습도`: 주변 습도 (%)
- `bean_color` 또는 `원두색상`: 원두 색상 (Green, Yellow, Light Brown, Brown, Dark Brown, Very Dark)

### 상세 설치 가이드

1. **환경 설정**
```bash
# 저장소 클론
git clone <repository-url>
cd Coffee-roasting-tracking-system

# 가상환경 생성 및 활성화
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 의존성 설치
pip install -r requirements.txt
```

2. **샘플 데이터 생성 (선택사항)**
```bash
# 샘플 로스팅 프로파일 생성
python scripts/generate_sample_data.py
```

3. **대시보드 실행**
```bash
# Streamlit 대시보드 실행
streamlit run app/main.py

# 또는 스크립트 사용
bash scripts/run_dashboard.sh
```

4. **사용 방법**
   - 사이드바에서 프로파일 이름, 원두 종류, 목표 배전도 설정
   - "로스팅 시작" 버튼 클릭
   - 센서 데이터 입력 폼에 온도, 습도, 가열량 입력
   - "데이터 추가" 버튼으로 실시간 데이터 추가
   - 대시보드에서 실시간 그래프 및 단계 감지 확인
   - 목표 배전도 도달 시간 예측 확인
   - 로스팅 완료 후 "프로파일 저장" 버튼으로 저장

## 프로젝트 구조

```
Coffee-roasting-tracking-system/
├── app/                    # Streamlit 대시보드
│   ├── __init__.py
│   └── main.py            # 메인 대시보드 앱
├── src/                    # 핵심 로직 모듈
│   ├── __init__.py
│   ├── data/              # 데이터 처리 모듈
│   │   ├── __init__.py
│   │   ├── processor.py   # 센서 데이터 처리
│   │   └── profile_manager.py  # 프로파일 저장/관리
│   ├── algorithms/        # 알고리즘 모듈
│   │   ├── __init__.py
│   │   └── stage_detector.py  # 로스팅 단계 감지
│   ├── prediction/        # 예측 모듈
│   │   ├── __init__.py
│   │   └── roast_predictor.py  # 배전도 도달 예측
│   └── utils/             # 유틸리티
│       ├── __init__.py
│       └── constants.py   # 상수 정의
├── configs/               # 설정 파일
│   └── config.yaml
├── data/                  # 데이터 디렉토리
│   ├── raw/              # 원본 데이터
│   └── processed/        # 처리된 데이터 (DB)
├── scripts/              # 실행 스크립트
│   ├── generate_sample_data.py  # 샘플 데이터 생성
│   └── run_dashboard.sh  # 대시보드 실행 스크립트
├── docs/                 # 문서
├── requirements.txt      # Python 의존성
├── LICENSE
└── README.md
```

## 주요 기능 상세 설명

### 1. 실시간 센서 데이터 수집

- 원두 온도 (Bean Temperature)
- 드럼 온도 (Drum Temperature)
- 습도 (Relative Humidity)
- 가열량 (Heating Power %)
- 시간 (Timestamp)

### 2. RoR 계산

Rate of Rise를 실시간으로 계산하여 로스팅 진행 상황을 정량적으로 파악합니다.

### 3. 로스팅 단계 자동 감지

온도, RoR, 습도 등을 종합적으로 분석하여 현재 로스팅 단계를 자동으로 감지합니다.

- 건조 단계
- 갈변 단계
- 1차 크랙 감지
- 발열/발화 구간
- 2차 크랙 감지

### 4. 목표 배전도 도달 예측

현재 상태를 기반으로 목표 배전도에 도달하는 예상 시간을 계산하고, 진행률을 표시합니다.

### 5. 데이터 시각화

- 실시간 온도 그래프 (원두 온도 / 드럼 온도)
- RoR 곡선
- 습도 변화 그래프
- 가열량 변화 그래프
- 로스팅 단계 표시

### 6. 프로파일 저장 및 관리

- 로스팅 프로파일 저장 (SQLite)
- 프로파일 목록 조회 및 필터링
- 프로파일 비교 분석
- 프로파일 삭제

## 실험 결과 및 검증

### 알고리즘 검증

- **단계 감지 정확도**: 온도 임계값 및 RoR 패턴 기반으로 단계 감지
- **크랙 감지**: 1차/2차 크랙 구간에서 RoR 급감 패턴 감지 성공
- **예측 정확도**: 선형 예측 모델 + RoR 감쇠 보정으로 목표 도달 시간 예측

### 샘플 데이터

프로젝트에는 다양한 원두 종류와 배전도에 대한 샘플 프로파일이 포함되어 있습니다:

- 에티오피아 예가체프 (약배전)
- 콜롬비아 수프리모 (중배전)
- 브라질 산토스 (중강배전)
- 인도네시아 만델링 (강배전)

## 핵심 기술 설명

### 데이터 기반 사고

온도·습도·RoR·시간 같은 연속 센서 데이터를 구조화하고 분석하여 로스팅 공정을 정량적으로 추적합니다.

### 문제 정의 & 해결

"경험 의존적인 로스팅 공정"을 "데이터 기반 의사결정"으로 전환하여 재현 가능한 로스팅 프로파일을 만듭니다.

### 알고리즘/모델링 역량

RoR 계산, 크랙 감지 룰, 배전도 도달 시간 예측 로직을 직접 설계하고 구현했습니다.

### 서비스 구현 능력

실시간 대시보드, 상태 표시, 프로파일 저장/조회 등 프론트(시각화) + 백엔드(로직, 저장) 구조를 혼자 설계·구현했습니다.

## 향후 개선 사항

- [ ] 실제 센서 하드웨어 연동 (Arduino/Raspberry Pi)
- [ ] 머신러닝 기반 예측 모델 고도화 (LSTM, 시계열 예측)
- [ ] 다중 프로파일 비교 분석 기능 강화
- [ ] 모바일 앱 연동
- [ ] 클라우드 배포 (Streamlit Cloud, AWS 등)
- [ ] 알림 기능 강화 (이메일, SMS 등)

## 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다. 자세한 내용은 [LICENSE](LICENSE) 파일을 참조하세요.

## 기여

이슈 리포트 및 풀 리퀘스트를 환영합니다! 프로젝트를 개선하는 데 도움을 주시면 감사하겠습니다.

## 연락처

프로젝트에 대한 질문이나 제안사항이 있으시면 이슈를 등록해주세요.

---

**실제 카페 운영 경험을 바탕으로 한 데이터 기반 로스팅 어시스턴트**
