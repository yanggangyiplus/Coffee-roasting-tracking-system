# 주요 기능 상세 설명

## 1. 데이터 입력 모드

### 수동 입력 모드
웹 인터페이스를 통해 센서 데이터를 직접 입력할 수 있습니다.
- 원두 온도, 드럼 온도, 습도, 가열량 입력
- 주변 온도/습도 입력 (선택사항)
- 원두 색상 선택 (선택사항)
- "데이터 추가" 버튼으로 실시간 데이터 추가

### 파일 업로드 모드
CSV 또는 엑셀 파일을 업로드하여 기존 로스팅 데이터를 분석할 수 있습니다.

**지원 파일 형식**:
- CSV (.csv)
- 엑셀 (.xlsx, .xls)

**컬럼 이름 자동 매핑**:
시스템은 다양한 컬럼 이름을 자동으로 인식합니다:
- `bean_temp`, `bean temperature`, `원두온도`, `원두 온도`, `bt`, `bean temp`
- `drum_temp`, `drum temperature`, `드럼온도`, `드럼 온도`, `et`, `env_temp`
- `humidity`, `습도`, `rh`, `relative humidity`
- `heating_power`, `heating power`, `가열량`, `power`
- `timestamp`, `time`, `시간`, `datetime`
- `ambient_temp`, `ambient temperature`, `주변온도`, `날씨온도`
- `ambient_humidity`, `ambient humidity`, `주변습도`, `날씨습도`
- `bean_color`, `bean color`, `원두색상`, `원두 색상`, `color`

### 실시간 센서 모드
실제 센서 하드웨어와 연동하여 실시간으로 데이터를 수집할 수 있습니다.

**모의 센서 (테스트용)**:
- 실제 하드웨어 없이 테스트할 수 있는 모의 센서 제공
- 시간에 따라 온도가 증가하는 로스팅 프로파일 시뮬레이션

**실제 센서 연동**:
- `RealSensorStream` 클래스를 상속받아 구현
- Arduino, Raspberry Pi 등 다양한 하드웨어 지원 가능
- 예시:
```python
class ArduinoSensorStream(RealSensorStream):
    def __init__(self, port="/dev/ttyUSB0"):
        super().__init__()
        import serial
        self.serial = serial.Serial(port, 9600)
    
    def read_sensor_data(self):
        line = self.serial.readline().decode()
        # 파싱 로직
        return parsed_data
```

## 2. 로스팅 단계 감지

시스템은 다음 단계를 자동으로 감지합니다:

### 생원두 단계
- **온도 범위**: 50°C 이하
- **특징**: 로스팅 시작 전 상태

### 건조 단계 (Drying Phase)
- **온도 범위**: 50°C ~ 150°C
- **특징**: 높은 습도, 급격한 온도 상승

### 갈변 단계 (Maillard Phase)
- **온도 범위**: 150°C ~ 190°C
- **특징**: 완만한 온도 상승, RoR 감소

### 1차 크랙 (First Crack)
- **온도 범위**: 190°C ~ 205°C
- **감지 조건**:
  - 온도가 범위 내 도달
  - RoR이 급격히 감소 (5도/분 이상)
  - 온도 변화 패턴 급변

### 발열/발화 구간 (Development)
- **온도 범위**: 205°C ~ 220°C
- **특징**: 1차 크랙 이후 ~ 2차 크랙 이전

### 2차 크랙 (Second Crack)
- **온도 범위**: 220°C ~ 240°C
- **감지 조건**:
  - 1차 크랙 이후
  - 온도가 범위 내 도달
  - RoR이 급격히 감소 (3도/분 이상)

## 3. 배전도 감지

시스템은 현재 원두의 배전도를 자동으로 감지합니다:

- **생원두 (Green)**: 50°C 이하
- **약배전 (Light)**: 195°C ~ 205°C (1차 크랙 직후)
- **중배전 (Medium)**: 205°C ~ 215°C
- **중강배전 (Medium Dark)**: 215°C ~ 225°C
- **강배전 (Dark)**: 225°C ~ 240°C (2차 크랙 이후)

## 4. 원두 색상 감지

온도에 따라 원두 색상을 자동으로 감지합니다:

- **Green (생원두)**: 50°C 미만
- **Yellow (노란색)**: 50°C ~ 100°C
- **Light Brown (밝은 갈색)**: 100°C ~ 150°C
- **Brown (갈색)**: 150°C ~ 190°C
- **Dark Brown (진한 갈색)**: 190°C ~ 220°C
- **Very Dark (매우 진한 갈색)**: 220°C 이상

## 5. 목표 배전도 도달 예측

현재 상태를 기반으로 목표 배전도에 도달하는 시간을 예측합니다.

**예측 알고리즘**:
- 선형 예측: `예상시간 = 온도차이 / 현재 RoR`
- RoR 감쇠 보정: 시간이 지날수록 RoR이 감소하는 것을 고려
- 진행률 계산: 현재 온도 기준 목표까지의 진행률 표시

## 6. 데이터 시각화

다음 그래프를 실시간으로 표시합니다:

- **온도 그래프**: 원두 온도, 드럼 온도, 주변 온도
- **RoR 곡선**: Rate of Rise 변화
- **습도 그래프**: 로스팅기 습도, 주변 습도
- **가열량 그래프**: 가열량 변화
- **원두 색상 분포**: 색상별 데이터 포인트 수

## 7. 데이터 다운로드

실시간으로 수집된 데이터를 CSV 형식으로 다운로드할 수 있습니다.

**다운로드 내용**:
- 모든 센서 데이터 (온도, 습도, 가열량 등)
- 계산된 RoR 값
- 경과 시간
- 타임스탬프
- 원두 색상 (있는 경우)
- 주변 온도/습도 (있는 경우)

## 8. 프로파일 저장 및 관리

로스팅 프로파일을 SQLite 데이터베이스에 저장하고 관리할 수 있습니다.

**기능**:
- 프로파일 저장: 메타데이터와 센서 데이터 함께 저장
- 프로파일 목록 조회: 필터링 기능 지원 (원두 종류, 배전도, 날짜)
- 프로파일 상세 보기: 그래프 및 통계 정보 표시
- 프로파일 비교: 여러 프로파일을 비교 분석
- 프로파일 삭제: 불필요한 프로파일 삭제
- 프로파일 데이터 다운로드: 저장된 프로파일을 CSV로 다운로드

